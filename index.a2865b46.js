function t(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function e(e){return function(e){if(Array.isArray(e))return t(e)}(e)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(e)||function(e,r){if(e){if("string"==typeof e)return t(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return t(e,void 0)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var r=Array.from(document.querySelectorAll(".field-row .field-cell")),n=document.querySelector(".game-score"),o=document.querySelector(".button"),a=document.querySelector(".message-start"),i=document.querySelector(".message-win"),l=document.querySelector(".message-lose"),c=document.querySelector(".game-field"),f="undefined"!=typeof window&&!!window.Cypress,u=new Game("undefined"!=typeof window?window.initialState:void 0),s=u.getState().map(function(t){return t.slice()}),d=!1,v=document.createElement("div");v.className="anim-layer",c.appendChild(v);var m=function(t,e){return r[4*t+e]};function y(){var t,e,c=u.getState();!function(t){var e=0,n=!0,o=!1,a=void 0,i=!0,l=!1,c=void 0;try{for(var f,u=t[Symbol.iterator]();!(i=(f=u.next()).done);i=!0){var s=f.value;try{for(var d,v=s[Symbol.iterator]();!(n=(d=v.next()).done);n=!0)!function(){var t=d.value,n=r[e++];n.textContent=t?String(t):"",Array.from(n.classList).filter(function(t){return t.startsWith("field-cell--")||"spawn"===t||"bump"===t}).forEach(function(t){return n.classList.remove(t)}),t&&n.classList.add("field-cell--".concat(t))}()}catch(t){o=!0,a=t}finally{try{n||null==v.return||v.return()}finally{if(o)throw a}}}}catch(t){l=!0,c=t}finally{try{i||null==u.return||u.return()}finally{if(l)throw c}}}(c),t=u.getScore(),n.textContent=String(t),e=u.getStatus(),a.classList.add("hidden"),i.classList.toggle("hidden","win"!==e),l.classList.toggle("hidden","lose"!==e);var d="idle"===u.getStatus();o.textContent=d?"Start":"Restart",o.classList.toggle("start",d),o.classList.toggle("restart",!d),function(t,e){var n=function(n){for(var a=0;a<4;a++)!function(a){var i=t[n][a],l=e[n][a],c=r[o++];0===i&&l>0?(c.classList.remove("spawn"),c.getBoundingClientRect(),c.classList.add("spawn"),c.addEventListener("animationend",function(){return c.classList.remove("spawn")},{once:!0})):i>0&&l>i&&(c.classList.remove("bump"),c.getBoundingClientRect(),c.classList.add("bump"),c.addEventListener("animationend",function(){return c.classList.remove("bump")},{once:!0}))}(a)};if(!f)for(var o=0,a=0;a<4;a++)n(a)}(s,c),s=c.map(function(t){return t.slice()})}function p(t,e){for(var r=[],n=0;n<4;n++)0!==t[n]&&r.push({val:t[n],c:n});for(var o=[],a=0,i=0;i<r.length;i++)i+1<r.length&&r[i].val===r[i+1].val?(o.push({fromR:e,fromC:r[i].c,toR:e,toC:a,value:r[i].val}),o.push({fromR:e,fromC:r[i+1].c,toR:e,toC:a,value:r[i+1].val}),a++,i++):(o.push({fromR:e,fromC:r[i].c,toR:e,toC:a,value:r[i].val}),a++);return o}function h(t,e){var r=m(t,e);r.textContent="",Array.from(r.classList).filter(function(t){return t.startsWith("field-cell--")||"spawn"===t||"bump"===t}).forEach(function(t){return r.classList.remove(t)})}function g(t){if("playing"===u.getStatus()){var r=function(t,r){var n=[];if("left"===r)for(var o=0;o<4;o++)n.push.apply(n,e(p(t[o],o)));else if("right"===r)for(var a=0;a<4;a++){var i=p(e(t[a]).reverse(),a),l=!0,c=!1,f=void 0;try{for(var u,s=i[Symbol.iterator]();!(l=(u=s.next()).done);l=!0){var d=u.value;d.toC=3-d.toC,d.fromC=3-d.fromC}}catch(t){c=!0,f=t}finally{try{l||null==s.return||s.return()}finally{if(c)throw f}}n.push.apply(n,e(i))}else if("up"===r)for(var v=0;v<4;v++){var m=p([t[0][v],t[1][v],t[2][v],t[3][v]],0),y=!0,h=!1,g=void 0;try{for(var C,w=m[Symbol.iterator]();!(y=(C=w.next()).done);y=!0){var S=C.value;S.fromR=S.fromC,S.fromC=v,S.toR=S.toC,S.toC=v}}catch(t){h=!0,g=t}finally{try{y||null==w.return||w.return()}finally{if(h)throw g}}n.push.apply(n,e(m))}else if("down"===r)for(var R=0;R<4;R++){var L=p([t[3][R],t[2][R],t[1][R],t[0][R]],0),b=!0,x=!1,A=void 0;try{for(var E,q=L[Symbol.iterator]();!(b=(E=q.next()).done);b=!0){var k=E.value,B=k.fromC,j=k.toC;k.fromR=3-B,k.fromC=R,k.toR=3-j,k.toC=R}}catch(t){x=!0,A=t}finally{try{b||null==q.return||q.return()}finally{if(x)throw A}}n.push.apply(n,e(L))}return n.filter(function(t){return t.fromR!==t.toR||t.fromC!==t.toC})}(u.getState().map(function(t){return t.slice()}),t);r.length&&(f||!d)&&(f||(d=!0),"left"===t?u.moveLeft():"right"===t?u.moveRight():"up"===t?u.moveUp():u.moveDown(),f?y():function(t,e){if(!t.length){e();return}var r=c.getBoundingClientRect(),n=[],o=new Set,a=!0,i=!1,l=void 0;try{for(var f,u=t[Symbol.iterator]();!(a=(f=u.next()).done);a=!0){var s=f.value,d="".concat(s.fromR,"-").concat(s.fromC),y="".concat(s.toR,"-").concat(s.toC);o.has(d)||(h(s.fromR,s.fromC),o.add(d)),o.has(y)||(h(s.toR,s.toC),o.add(y))}}catch(t){i=!0,l=t}finally{try{a||null==u.return||u.return()}finally{if(i)throw l}}var p=!0,g=!1,C=void 0;try{for(var w,S=t[Symbol.iterator]();!(p=(w=S.next()).done);p=!0)!function(){var t=w.value,e=m(t.fromR,t.fromC).getBoundingClientRect(),o=m(t.toR,t.toC).getBoundingClientRect(),a=document.createElement("div");a.className="ghost field-cell field-cell--".concat(t.value),a.textContent=String(t.value),a.style.left="".concat(e.left-r.left,"px"),a.style.top="".concat(e.top-r.top,"px"),a.style.transform="translate(0px, 0px) scale(0.9)",v.appendChild(a),n.push(a),requestAnimationFrame(function(){var t=o.left-e.left,r=o.top-e.top;a.style.transform="translate(".concat(t,"px, ").concat(r,"px) scale(0.9)")})}()}catch(t){g=!0,C=t}finally{try{p||null==S.return||S.return()}finally{if(g)throw C}}for(var R=0,L=function(){++R===n.length&&(n.forEach(function(t){return t.remove()}),e())},b=0;b<n.length;b++)n[b].addEventListener("transitionend",L,{once:!0});setTimeout(function(){n.forEach(function(t){return t.removeEventListener("transitionend",L)}),n.forEach(function(t){return t.remove()}),e()},620)}(r,function(){y(),d=!1}))}}document.addEventListener("keydown",function(t){"ArrowLeft"===t.key?g("left"):"ArrowRight"===t.key?g("right"):"ArrowUp"===t.key?g("up"):"ArrowDown"===t.key&&g("down")}),o.addEventListener("click",function(){(f||!d)&&("idle"===u.getStatus()||u.restart(),u.start(),y())}),y();
//# sourceMappingURL=index.a2865b46.js.map
